# mysql 로그는 json형식으로 안되어 있음. 그래서 json처럼 키 값을 이용하여 데이터를 가져올 수 가 없음
# 그래서 일단 전체 데이터를 ,로 한 줄 한 줄 자름
# 한 줄씩 잘라진 문장에서 시간과 내용 데이터만 따로 리스트를 만들어 분석에 사용할 수 있음


import json
import gzip
import os 
import sys


mysql_path = 'C:/Users/dolif/Desktop/프로젝트/log/mysqllog/2021/5/29/46d4769b089966df22b862/000000.gz'

# -- gzip으로 파일 읽기 -- 일단 절대 경로로 읽어오기!

# with gzip.open(path,'rb') as rb_lambda: # 람다 로그 읽기
#     print(rb_lambda.readlines())

# with gzip.open(ct_path,'rb') as ct_lambda:   # 클라우드 트레일 로그.. 이거 너무 길어.. 파이썬으로 보기 너무 힘듬
#     print(ct_lambda.readlines())


# -- mysql 로그 읽기 -> json형식으로 안되어 있음
mysql_rb = gzip.open(mysql_path,'rb')
mysql_rb_data = mysql_rb.readlines()

# 로그 내용 ,로 자른 후 리스트로 만들기
mysql_split = str(mysql_rb_data).split(',')

# 시간만 저장되어 있는 리스트, 내용만 저장되어 있는 리스트 만들기

list_t = []
list_Note = []

# -- 시간 리스트

for i in range(len(mysql_split)):
    split_ex_t = mysql_split[i][1:27] # 시간 부분만 자르기
    if split_ex_t.endswith('Z') : # 시간만 자른 내용 중에 z로 끝난 것만 추가함, Z로 끝난 데이터는 시간 데이터가 아니기 때문
        list_t.append(split_ex_t)
 
# -- 데이터 리스트
S_NOTE = mysql_split[0].find('[Note]') # 데이터에서 [NOTE인] 위치 찾기

for i in range(len(mysql_split)):
    split_ex_d = mysql_split[i][S_NOTE:] 
    if split_ex_d.startswith('[Note]') : # [Note]로 시작된 것만 리스트에 추가
        list_Note.append(split_ex_d)

# -- 시간 데이터 리스트, 내용 리스트 확인
for i in list_t:
    print(i)

for i in list_Note:
    print(i)
